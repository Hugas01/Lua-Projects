---
--- Generated by EmmyLua(https://github.com/EmmyLua)
--- Created by info.
--- DateTime: 02.05.2021 14:48
---

local githuburl = "https://raw.githubusercontent.com/Seniorendi/Lua-Projects/master/src/Programs.txt"

--TODO: Safe this in a file
local firstStart = true

programs = {}

local args = {...}

function loadSources()
    local dl, error = http.get("https://raw.githubusercontent.com/Seniorendi/Lua-Projects/master/src/Programs.txt?q=random_string")
    if dl then
        text = dl.readAll()
        text:gsub("\n", "")
        text:gsub("\\", "")
        programs = textutils.unserialize(text)
    end
end

function startupInstall(program)
    if programs[program] == nil then
        error("Program '"..program.."' does not exists!")
    elseif installed[program] == nil then
        error("Program '"..program.."' is not installed!")
    end

    local startup = programs[program]["startup"]

    if fs.exists("startup") then
        fs.delete("startup")
    end
        local sfile = fs.open("startup", "w")
        sfile.write(startup)
        sfile.close()

end

function showHelp()
    print("installer help               - Shows this menu")
    print("installer install <program> - Installs a program")
    print("installer update <program>  - Updates a program")
    print("installer delete <program>  - Deletes a program")
    print("installer config <program>  - Configures a program after it is installed")
end

function showList()
    for name, table in pairs(programs) do
        write(name)
        write("------")
        write(table.desc .. "\n")
    end
end

function executeInput()
    if #args <= 0 then
        showHelp()
    end
    if #args >= 1 and args[1] == "help" then
        showHelp()
    elseif #args >= 1 and args[1] == "list" then
        showList()
    elseif #args >= 1 and args[1] == "install" then
        --Install the shit
    end
end

if firstStart then
    print("Prepare first start...")
    if fs.exists("startup") or fs.exists("startup.lua") then
        error("Delete the startup file and install this program as installer!")
    end
    print("Download sources...")
    loadSources()
    print("Loaded programs")
    executeInput()
end